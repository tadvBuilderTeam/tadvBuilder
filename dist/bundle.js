var h=class r{constructor(e,t="",n=null,o=null){if(this.key=e,this.text=t,this.parent=n,this.choices=new Map,o instanceof Map)for(let[c,s]of o)this.choices.set(c,s);else if(Array.isArray(o))for(let c of o)c.next&&c.text&&this.choices.set(c.next,c.text)}addChoice(e,t){return this.choices.has(t)?!1:(this.choices.set(t,e),!0)}updateContent(e,t=null){let n=!1;return typeof e=="string"&&e.trim()!==""&&(this.text=e,n=!0),this.choicesAreEqual(t)||(t instanceof Map&&t?(this.choices=t,n=!0):t===null&&(this.choices.clear(),n=!0)),n}updateChoiceText(e,t){return this.choices.has(e)?(this.choices.set(e,t),!0):!1}removeChoice(e){return this.choices.delete(e)}getAllChoices(){return Array.from(this.choices,([e,t])=>({text:t,next:e}))}choicesAreEqual(e){if(!e||this.choices.size!==e.size)return!1;for(let[t,n]of this.choices)if(e.get(t)!==n)return!1;return!0}static fromJson(e,t){if(!e||!t)return null;let n=null;if(typeof t=="string")try{n=JSON.parse(t)}catch(c){return console.error(`Failed to parse JSON for scene ${e}: ${c}`),null}else if(typeof t=="object")n=t;else return console.error(`Failed to parse JSON for scene ${e}: Invalid JSON type`),null;if(!n.text||typeof n.text!="string")return console.error(`Scene ${e} missing text property.`),null;let o=new r(e,n.text,null,[]);if(Array.isArray(n.choices))for(let c of n.choices)!c||typeof c.text!="string"||typeof c.next!="string"||o.addChoice(c.text,c.next);return o}toJSON(){let e=[];for(let[t,n]of this.choices.entries())e.push({text:n,next:t});return e.length===0?{text:this.text}:{text:this.text,choices:e}}};var m=class r{constructor(){this.scenes=new Map,this.root=null}addScene(e){if(this.scenes.has(e.key))return!1;if(this.scenes.set(e.key,e),!this.root)return this.root=e,!0;if(!e.parent&&this.root&&this.scenes.size>0){let t=this.findParent(e.key);t?(e.parent=t,t.addChoice(e.text||`to ${e.key}`,e.key)):(this.root.addChoice(e.text||`to ${e.key}`,e.key),e.parent=this.root)}return e.parent&&this.scenes.has(e.parent.key)&&this.scenes.get(e.parent.key).addChoice(e.text||`to ${e.key}`,e.key),!0}findParent(e){for(let t of this.scenes.values())if(t.choices instanceof Map&&t.choices.has(e))return t;return null}getScene(e){return this.scenes.get(e)||null}static getSceneDepth(e,t){if(!e.has(t.key))return-1;let n=0,o=t;for(;o&&o.parent;)n++,o=o.parent;return n}static getScenesDFS(e,t=e.root){if(!e||!t)return[];let n=[],o=[],c=new Set,s=0;for(t!==e.root&&(s=r.getSceneDepth(e.scenes,t)),o.push({scene:t,depth:s});o.length>0;){let{scene:i,depth:g}=o.pop();if(c.has(i.key))continue;c.add(i.key),n.push({key:i.key,scene:i,depth:g});let I=Array.from(i.choices.keys()).map(l=>e.getScene(l)).filter(l=>l&&!c.has(l.key));for(let l=I.length-1;l>=0;l--)o.push({scene:I[l],depth:g+1})}return n}static hasCircle(e){let t=new Set,n=r.getScenesDFS(e);for(let{scene:o}of n)if(o){for(let c of o.choices.keys()){let s=e.getScene(c);if(s&&t.has(s.key))return!0}t.add(o.key)}return!1}editScene(e,t,n){let o=this.scenes.get(e);return o?o.updateContent(t,n):(console.warn(`Scene ${e} not found`),!1)}changeSceneParent(e,t){let n=this.scenes.get(e);n||console.warn(`Scene ${e} not found`);let o=n.parent.choices.get(n.key).text;n.parent.removeChoice(n.key);let c=this.scenes.get(t);return c?(n.parent=c,c.addChoice(o||`to ${n.key}`,n.key),!0):(n.parent=null,!1)}removeScene(e){let t=this.scenes.get(e);if(!t)return console.warn(`Scene ${e} not found`),!1;t.parent&&t.parent.removeChoice(t.key);let n=r.getScenesDFS(this,t);for(let o=n.length-1;o>=0;o--){let{key:c}=n[o];this.scenes.delete(c)}return!0}toJSON(){let e={};for(let[t,n]of this.scenes.entries())e[t]=n.toJSON();return e}static fromJson(e){if(!e||typeof e!="object")return null;let t=new r(h);for(let[n,o]of Object.entries(e)){let c=h.fromJson(n,o);if(c)t.addScene(c);else return console.warn(`Failed to load scene ${n}`),null}return t.scenes.size===0?(console.warn("No scenes found in JSON"),null):t}};var b=class r{constructor(){throw new Error("Static class")}static async loadFromJson(e){if(!e||typeof e!="string")return null;let t=null;try{let n=await fetch(e);if(!n.ok)return null;t=await n.json()}catch{return null}return typeof m.fromJson!="function"?(console.warn("Story has no method called: fromJson"),null):m.fromJson(t)}static async saveToJson(e,t){if(!e||!t||typeof t!="string")return console.error("Ung√ºltige Eingabeparameter in saveToJson: story = ",e,", filename = ",t),!1;let n=e.toJSON();try{let o=JSON.stringify(n),c=new Blob([o],{type:"text/json"}),s=document.createElement("a");s.href=URL.createObjectURL(c),s.download=t,s.click(),URL.revokeObjectURL(s.href),console.log("Story saved to Json")}catch(o){return console.error("Failed to save story to Json:"+o),!1}return!0}static async saveToHtml(e,t){if(!e||!t||typeof t!="string")return console.error("Ung√ºltige Eingabeparameter in saveToHtml: story = ",e,", filename = ",t),!1;let n="PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+U3RvcnktVmlld2VyPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICBib2R5IHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IHN5c3RlbS11aSwgc2Fucy1zZXJpZjsKICAgICAgICB9CiAgICAgICAgaDIgewogICAgICAgICAgICBjb2xvcjogIzBmMTcyYTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMC4yNXJlbTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjFmNWY5OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2JkNWUxOwogICAgICAgICAgICBwYWRkaW5nOiAxcmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICBtYXgtd2lkdGg6IDgwMHB4OwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjA2KTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgYnV0dG9uIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzNiODJmNjsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBwYWRkaW5nOiAwLjZyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDAuNXJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJnYW1lIj48L2Rpdj4KCjxzY3JpcHQ+CiAgICBjb25zdCBzdG9yeSA9IHsKICAgICAgICAvLyBJTlNFUlQgSlNPTiBTVE9SWSBIRVJFCg==",o="ICAgIH07CgogICAgZnVuY3Rpb24gc2hvd1NjZW5lKGtleSkKICAgIHsKICAgICAgICBjb25zdCBzY2VuZSA9IHN0b3J5W2tleV07CiAgICAgICAgaWYgKCFzY2VuZSkgcmV0dXJuOwoKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2FtZSIpOwogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAiIjsgLy8gZGVsZXRlIHByZXZpb3VzIGNvbnRlbnQvc2NlbmUKCiAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJoMiIpOwogICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0ga2V5OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpOwoKICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBzY2VuZS50ZXh0OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dCk7CgogICAgICAgIGlmICghc2NlbmUuY2hvaWNlcyB8fCBzY2VuZS5jaG9pY2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICAgICAgICBmb3IgKGNvbnN0IGMgb2Ygc2NlbmUuY2hvaWNlcykgewogICAgICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gYy50ZXh0OwogICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBzaG93U2NlbmUoYy5uZXh0KSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgICAgfQogICAgfQoKICAgIHNob3dTY2VuZSgic3RhcnQiKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==",c=e.toJSON(),s=JSON.stringify(c);s=s.slice(1,-1);try{let i=window.atob(n)+s+window.atob(o),g=new Blob([i],{type:"text/html"}),I=document.createElement("a");I.href=URL.createObjectURL(g),I.download=t,I.click(),URL.revokeObjectURL(I.href),console.log("Story saved to Html")}catch(i){return console.error("Failed to save story to Json:"+i),!1}return!0}static async saveToEncryptedHtml(e,t,n){if(!e||!t||typeof t!="string"||!n)return console.error("Ung√ºltige Parameter in saveToEncryptedHtml"),!1;let o="PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+T2JmdXNjYXRlZCBTdG9yeS1WaWV3ZXI8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIGJvZHkgewogICAgICAgICAgICBmb250LWZhbWlseTogc3lzdGVtLXVpLCBzYW5zLXNlcmlmOwogICAgICAgIH0KICAgICAgICBoMiB7CiAgICAgICAgICAgIGNvbG9yOiAjMGYxNzJhOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwLjI1cmVtOwogICAgICAgIH0KICAgICAgICAjZ2FtZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmMWY1Zjk7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjYmQ1ZTE7CiAgICAgICAgICAgIHBhZGRpbmc6IDFyZW07CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgbWFyZ2luOiAwIGF1dG87CiAgICAgICAgICAgIG1heC13aWR0aDogODAwcHg7CiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDAsMCwwLDAuMDYpOwogICAgICAgIH0KICAgICAgICAjZ2FtZSBidXR0b24gewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjM2I4MmY2OwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIHBhZGRpbmc6IDAuNnJlbSAxcmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMC41cmVtOwogICAgICAgICAgICBmb250LXdlaWdodDogNTAwOwogICAgICAgIH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgaWQ9ImdhbWUiPjwvZGl2PgoKPHNjcmlwdD4KICAgIC8vID09PSBjb25maWcgPT09CiAgICBjb25zdCBFTkNSWVBURURfU1RPUlkgPSAi",c="IjsKICAgIGNvbnN0IERFQ1JZUFRJT05fS0VZID0gIg==",s="IjsKCiAgICBsZXQgc3RvcnkgPSBudWxsOwoKICAgIGZ1bmN0aW9uIHNob3dTY2VuZShrZXkpCiAgICB7CiAgICAgICAgY29uc3Qgc2NlbmUgPSBzdG9yeVtrZXldOwogICAgICAgIGlmICghc2NlbmUpIHJldHVybjsKCiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImdhbWUiKTsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gIiI7IC8vIGRlbGV0ZSBwcmV2aW91cyBjb250ZW50L3NjZW5lCgogICAgICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaDIiKTsKICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IGtleTsgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTsKCiAgICAgICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKTsKICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gc2NlbmUudGV4dDsgY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHQpOwoKICAgICAgICBpZiAoIXNjZW5lLmNob2ljZXMgfHwgc2NlbmUuY2hvaWNlcy5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICAgICAgZm9yIChjb25zdCBjIG9mIHNjZW5lLmNob2ljZXMpIHsKICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGMudGV4dDsKICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gc2hvd1NjZW5lKGMubmV4dCkpOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBYT1IgZGVjcnlwdGlvbiB3aXRoIHBvc2l0aW9uIG1peGluZwogICAgZnVuY3Rpb24gZGVjcnlwdFN0b3J5KGVuY3J5cHRlZEhleCwga2V5KSB7CiAgICAgICAgaWYoIWVuY3J5cHRlZEhleCB8fCBlbmNyeXB0ZWRIZXgubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVuY3J5cHRlZCBzdG9yeSBvciBrZXkgbm90IGZvdW5kLiIpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gSGV4IGRlY29kZQogICAgICAgICAgICBjb25zdCBlbmNyeXB0ZWQgPSBuZXcgVWludDhBcnJheShlbmNyeXB0ZWRIZXgubGVuZ3RoIC8gMik7CiAgICAgICAgICAgIGxldCBieXRlSW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVuY3J5cHRlZEhleC5sZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICAgICAgZW5jcnlwdGVkW2J5dGVJbmRleCsrXSA9IHBhcnNlSW50KGVuY3J5cHRlZEhleC5zbGljZShpLCBpICsgMiksIDE2KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3Qga2V5Qnl0ZXMgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoa2V5KTsKCiAgICAgICAgICAgIGNvbnN0IGRlY3J5cHRlZCA9IG5ldyBVaW50OEFycmF5KGVuY3J5cHRlZC5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVuY3J5cHRlZC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZGVjcnlwdGVkW2ldID0gZW5jcnlwdGVkW2ldIF4ga2V5Qnl0ZXNbaSAlIGtleUJ5dGVzLmxlbmd0aF0gXiAoaSAmIDB4RkYpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGRlY3J5cHRlZCk7CiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGpzb25TdHJpbmcpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRGVjcnlwdGlvbiBvZiBzdG9yeSBmYWlsZWQ6IiwgZSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBJbml0aWFsaXplIGdhbWUgd2l0aCBhc3luYy9hd2FpdAogICAgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUdhbWUoKSB7CiAgICAgICAgY29uc29sZS5sb2coIkluaXRpYWxpemluZyBnYW1lLi4uIik7CgogICAgICAgIHN0b3J5ID0gYXdhaXQgZGVjcnlwdFN0b3J5KEVOQ1JZUFRFRF9TVE9SWSwgREVDUllQVElPTl9LRVkpOwogICAgICAgIHN0b3J5ID0gSlNPTi5wYXJzZShzdG9yeSk7CiAgICAgICAgCiAgICAgICAgaWYgKCFzdG9yeSkgewogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2FtZSIpOwogICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gIjxwPkVycm9yOiBDb3VsZCBub3QgbG9hZCB0aGUgc3RvcnkuPC9wPiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnNvbGUubG9nKCJEaXNwbGF5aW5nIGZpcnN0IHNjZW5lLi4uIik7CiAgICAgICAgc2hvd1NjZW5lKCJzdGFydCIpOwogICAgfQoKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7CiAgICAgICAgaW5pdGlhbGl6ZUdhbWUoKS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGluaXRpYWxpemluZyBnYW1lOiIsIGVycm9yKTsKICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImdhbWUiKTsKICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICI8cD5BbiBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIGNoZWNrIHRoZSBjb25zb2xlIGZvciBkZXRhaWxzLjwvcD4iOwogICAgICAgIH0pOwogICAgfSk7CgogICAgc3RvcnkgPSBkZWNyeXB0U3RvcnkoRU5DUllQVEVEX1NUT1JZLCBERUNSWVBUSU9OX0tFWSk7CiAgICBzaG93U2NlbmUoInN0YXJ0Iik7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=",i=e.toJSON(),g=JSON.stringify(i),I=r.#e(g,n);try{let l=window.atob(o)+`${I}`+window.atob(c)+`${n}`+window.atob(s),C=new Blob([l],{type:"text/html"}),A=document.createElement("a");return A.href=URL.createObjectURL(C),A.download=t,A.click(),URL.revokeObjectURL(A.href),console.log("Encrypted story saved to HTML"),!0}catch(l){return console.error("Failed to save encrypted story: "+l),!1}}static#e(e,t){let n=JSON.stringify(e),o=new TextEncoder().encode(n),c=new TextEncoder().encode(t),s=new Uint8Array(o.length);for(let g=0;g<o.length;g++)s[g]=o[g]^c[g%c.length]^g&255;let i="";for(let g=0;g<s.length;g++){let I=s[g].toString(16).padStart(2,"0");i+=I}return i}};var f=class{static generateTreeAscii(e,t=document.getElementById("tree-output")){if(console.log("StoryTreeRenderer.generateTreeAscii. Parent: "+t.id+" Story: "+e.root.key),!t)return;if(!e||!e.root){t.textContent="(noch kein Baum erstellt)";return}let n=m.getScenesDFS(e,e.root),o=[];for(let s=0;s<n.length;s++){let{key:i,scene:g,depth:I}=n[s],l="";for(let C=0;C<I;C++)l+=C===I-1?"|_ ":"   ";i=String(i),g===null?o.push(l+"["+i+"](MISSING)"):o.push(l+i)}let c=o.join(`
`);t.textContent=c}};var a=class{static show(e,t,n,o="create"){if(!t)return;let c=n?"feedback-success":"feedback-error";if(o==="create"){let s=document.createElement("div");s.textContent=e,s.classList.add("feedback",c),t.appendChild(s),setTimeout(()=>s.remove(),3e3)}else o==="set"&&(t.textContent=e,t.classList.add("feedback",c))}};var p=class r{static render(e,t,n="play-area"){let o=document.getElementById(n);if(!o)return;let c=e.getScene(t);if(o.innerHTML="",!c){let g=document.createElement("p"),I=document.createElement("em");I.textContent="Szene '"+t+"' nicht gefunden.",g.appendChild(I),o.textContent="",o.appendChild(g);return}let s=document.createElement("p"),i=document.createElement("strong");i.textContent=t,s.append(i,": "+c.text),o.appendChild(s);for(let[g,I]of c.choices.entries()){let l=document.createElement("button");l.textContent=I,l.onclick=()=>r.render(e,g,n),o.appendChild(l),o.appendChild(document.createElement("br"))}}};var y=class r{static#e=new Map;static#c(e){return this.#e.has(e)||this.#e.set(e,new r(e)),this.#e.get(e)}static render(e,t="tree-html-area"){r.#c(t).render(e)}constructor(e){this.targetElementId=e,this.expanded=new Set}render(e){let t=this.#s();if(!t)return;if(this.#g(t),!this.#i(e)){this.#r(t);return}this.#l(e);let n=this.#I();this.#t(e.root.key,n,e,new Set),t.appendChild(n)}#s(){let e=document.getElementById(this.targetElementId);return e||console.warn(`TreeEditor: container with id "${this.targetElementId}" not found.`),e}#g(e){e.innerHTML=""}#i(e){return!!(e&&e.root)}#r(e){let t=document.createElement("p");t.textContent='Keine Startszene gefunden. Lege zuerst eine Szene mit dem Schl√ºssel "start" an.',e.appendChild(t)}#l(e){this.expanded.has(e.root.key)||this.expanded.add(e.root.key)}#I(){let e=document.createElement("ul");return e.classList.add("story-tree"),e}#t(e,t,n,o){let c=document.createElement("li"),s=n.getScene(e);if(!s){c.textContent=`${e} (Szene nicht gefunden)`;let C=this.#h(e,n);C.classList.add("tree-addscene-btn"),c.appendChild(C),t.appendChild(c);return}let i=this.#C(e,s,n);if(c.appendChild(i),t.appendChild(c),o.has(e)){let C=document.createElement("em");C.textContent=" (Zyklus)",c.appendChild(C);return}if(!this.#n(s)||!this.#o(e))return;let I=document.createElement("ul");c.appendChild(I);let l=new Set(o);l.add(e);for(let[C,A]of s.choices.entries()){let u=document.createElement("li"),Z=document.createElement("span");Z.classList.add("tree-edge"),Z.textContent=`‚Üí ${A}`,u.appendChild(Z);let G=document.createElement("ul");u.appendChild(G),I.appendChild(u),this.#t(C,G,n,l)}}#C(e,t,n){let o=document.createElement("div");o.classList.add("tree-node-header");let c=n&&n.root&&n.root.key===e;if(!c&&this.#n(t)){let i=this.#d(e,n);o.appendChild(i)}else o.appendChild(this.#a());let s=this.#A(e,t);if(o.appendChild(s),!c){let i=this.#u(e,n);s.appendChild(i)}return o}#d(e,t){let n=this.#o(e),o=document.createElement("button");return o.classList.add("tree-toggle"),o.setAttribute("aria-label",n?"Einklappen":"Ausklappen"),o.setAttribute("aria-expanded",String(n)),o.textContent=n?"‚àí":"+",o.addEventListener("click",c=>this.#m(c,e,t)),o}#a(){let e=document.createElement("span");return e.classList.add("tree-toggle-spacer"),e}#A(e,t){let n=document.createElement("span");n.classList.add("tree-node");let o=document.createElement("strong");return o.textContent=e,n.appendChild(o),n}#u(e,t){let n=document.createElement("button");return n.classList.add("tree-delete"),n.setAttribute("aria-label",`Szene "${e}" l√∂schen`),n.textContent="üóë",n.addEventListener("click",o=>{if(o.preventDefault(),o.stopPropagation(),!confirm(`Soll die Szene "${e}" wirklich gel√∂scht werden?`))return;if(!t.removeScene(e)){console.warn(`TreeEditor: Szene "${e}" konnte nicht gel√∂scht werden.`);return}this.expanded.delete(e),this.render(t)}),n}#h(e){let t=document.createElement("button");return t.classList.add("tree-add"),t.setAttribute("aria-label",`Szene "${e}" hinzuf√ºgen`),t.textContent="+",t.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation();let o=document.getElementById("creator-scene-key");o.value=e;let c=document.getElementById("create-scene-popup");c.style.display="block"}),t}#m(e,t,n){e.preventDefault(),e.stopPropagation(),this.#p(t),this.render(n)}#n(e){return!!(e.choices&&e.choices.size)}#o(e){return this.expanded.has(e)}#p(e){this.expanded.has(e)?this.expanded.delete(e):this.expanded.add(e)}};var B=class{constructor(e){this.story=e}static addChoiceField(e){if(!e){console.error("parentElement is not found.");return}let t=document.createElement("div");t.className="choice-inputs",t.innerHTML=`
        <input type="text" class="choice-text" placeholder="Entscheidungstext">
        <input type="text" class="choice-next" placeholder="N√§chste Szene (Schl√ºssel)">
      `,e.appendChild(t)}static addScene(e){let t=document.getElementById("creator-scene-key").value.trim(),n=document.getElementById("creator-scene-text").value.trim(),o=document.getElementById("scene-creator");if(!t||!n){a.show("Bitte Schl√ºssel und Text ausf√ºllen.",o,!1);return}let c=document.getElementById("creator-choices-container");console.log(c);let s=Array.from(c.querySelectorAll(".choice-inputs"));console.log(s);let i=new Map;if(s.forEach(I=>{let l=I.querySelector(".choice-text"),C=I.querySelector(".choice-next");C||console.log("No input for next scene key found. ");let A=l.value.trim(),u=C.value.trim();A&&u&&i.set(u,A)}),!e.addScene(new h(t,n,null,i))){a.show("Scene could not be added to story, key already exists.",o,!1);return}p.render(e,t),f.generateTreeAscii(e),y.render(e),document.getElementById("creator-scene-key").value="",document.getElementById("creator-scene-text").value="";let g=document.getElementById("creator-choices-container");g.innerHTML=`<div class="choice-inputs">
    <input type="text" class="choice-text" placeholder="Entscheidungstext">
    <input type="text" class="choice-next" placeholder="N√§chste Szene (Schl√ºssel)">
    </div>`,a.show("Szene wurde gespeichert.",o,!0)}static editScene(e){let t=document.getElementById("editor-scene-key"),n=document.getElementById("editor-scene-status"),o=document.getElementById("editor-scene-text"),c=document.getElementById("editor-choices-container"),s=t.value.trim(),i=o.value.trim();if(!s){a.show("Bitte gib den Schl√ºssel der zu bearbeitenden Szene ein.",n,!1);return}let g=new Map;for(let l of c.children){if(!l.classList.contains("choice-inputs"))continue;let C=l.querySelector(".choice-text"),A=l.querySelector(".choice-next");if(!C||!A||!(C instanceof HTMLInputElement)||!(A instanceof HTMLInputElement)){console.log("Error in editScene: Invalid choice input elements. Skipping choice.");continue}let u=A.value.trim(),Z=C.value.trim();u&&g.set(u,Z)}e.editScene(s,i,g)&&(p.render(e,s),a.show("Szene wurde erfolgreich bearbeitet.",n,!0))}};var d=new m(h),S=new B(d);function w(){if(!d.root){alert("Keine 'start'-Szene gefunden.");return}p.render(d,"start")}async function W(){let r=document.getElementById("json-file"),e=document.getElementById("import-status");if(!r.files.length){a.show("Bitte zuerst eine JSON-Datei ausw√§hlen.",e,!1);return}let t=r.files[0],n=URL.createObjectURL(t);try{if(d=await b.loadFromJson(n,h,m),!d){e.textContent="Fehler beim Laden: Story konnte nicht geladen werden.";return}S.story=d,a.show(`"${t.name}" erfolgreich geladen (${d.scenes.size} Szenen).`,e,!0),f.generateTreeAscii(d),y.render(d),w()}catch(o){a.show("Fehler beim Laden: "+o.message,e,!1)}finally{URL.revokeObjectURL(n)}}function k(){if(!d){a.show("No story available to export.",document.getElementById("import-status"),!1);return}b.saveToJson(d,"story.json")&&a.show("Story successfully exported to JSON.",document.getElementById("import-status"),!0)}function x(r){if(!d){a.show("No story available to export.",document.getElementById("import-status"),!1);return}let e=!1;r?e=b.saveToEncryptedHtml(d,"story.html","9oj7k&7C@b@W"):e=b.saveToHtml(d,"story.html"),e&&a.show("Story successfully exported to HTML.",document.getElementById("import-status"),!0)}function V(r){r==="default"?document.documentElement.removeAttribute("data-theme"):document.documentElement.setAttribute("data-theme",r)}function v(){let r=(e,t,n,o,c,s,i)=>{let g=document.getElementById(e),I=document.getElementById(t),l=document.getElementById(n),C=document.getElementById(o),A=document.getElementById(s),u=document.getElementById(c);I.addEventListener("click",function(){g.style.display="block"}),l.addEventListener("click",function(){g.style.display="none"}),window.addEventListener("click",function(Z){Z.target===g&&(g.style.display="none")}),C.addEventListener("click",function(){B.addChoiceField(A)}),u.addEventListener("click",function(){i(),g.style.display="none"})};r("create-scene-popup","showCreatorBtn","creator-closeBtn","creator-add-choice-btn","creator-submit-btn","creator-choices-container",function(){B.addScene(d)}),r("edit-scene-popup","showEditorBtn","editor-closeBtn","editor-add-choice-btn","editor-submit-btn","editor-choices-container",function(){B.editScene(d)})}window.renderScene=r=>p.render(d,r);window.removeScene=()=>S.removeScene();window.addEventListener("DOMContentLoaded",()=>{console.log("page is fully loaded"),document.getElementById("start-story").addEventListener("click",w),document.getElementById("btn-ascii-tree-refresh").addEventListener("click",()=>{f.generateTreeAscii(d)});let r=document.getElementById("btn-html-tree-refresh");r&&r.addEventListener("click",()=>y.render(d)),document.getElementById("import-json").addEventListener("click",W),document.getElementById("export-json").addEventListener("click",k),document.getElementById("export-html").addEventListener("click",()=>{let e=document.getElementById("export-antiscraping-check").checked;x(e)}),document.getElementById("theme-select").addEventListener("change",function(){V(this.value)}),v()});
//# sourceMappingURL=bundle.js.map
