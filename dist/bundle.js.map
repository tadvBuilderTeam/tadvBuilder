{
  "version": 3,
  "sources": ["../src/builder/core/Scene.js", "../src/builder/core/Story.js", "../src/builder/SaveLoad.js", "../src/builder/AsciiTreeRenderer.js", "../src/builder/Feedback.js", "../src/builder/SceneRenderer.js", "../src/builder/TreeEditor.js", "../src/builder/SceneEditor.js", "../src/builder/main.js"],
  "sourcesContent": ["/**\n * Represents a single scene (node) in the story tree.\n * Each scene has narrative text, a list of choices (edges to other scenes),\n * and a reference to its parent scene. The root scene has a null parent.\n * @property {string} key - Unique identifier for the scene.\n * @property {string} text - Narrative text for the scene.\n * @property {Scene|null} parent - Reference to the parent scene, or null for root.\n * @property {Map<string, string>} choices - Map of next scene keys to their descriptions.\n */\nexport default class Scene {\n    /**\n     * Root scene constructor.\n     * @param {string} key - Unique scene identifier.\n     * @param {string} text - Narrative text.\n     * @param {Scene|null} parent - Parent scene, or null for root.\n     * @param {Array<{text: string, next: string}>|Map<string, string>|null} choices - List of choices or null for leaf.\n     */\n    constructor(key, text = '', parent = null, choices = null)\n    {\n        this.key = key;\n        this.text = text;\n        this.parent = parent;\n        this.choices = new Map();\n\n        if (choices instanceof Map) {\n            for (const [next, choiceText] of choices) {\n                this.choices.set(next, choiceText);\n            }\n        } else if (Array.isArray(choices)) {\n            for (const c of choices) {\n                if (c.next && c.text) this.choices.set(c.next, c.text);\n            }\n        }\n    }\n\n\n    /**\n     * Adds a new choice (link) to another scene.\n     * @param {string} text - Description of the choice.\n     * @param {string} next - ID of the next scene.\n     * @returns {boolean} True if added successfully, false if duplicate key exists.\n     */\n    addChoice(text, next)\n    {\n        if (this.choices.has(next)) return false;\n        this.choices.set(next, text);\n        return true;\n    }\n\n    /**\n     * Edits the content of the scene, including the scene text and the choice texts.\n     * @param {string} newText The new scene text.\n     * @param {Map<string, string> | null} newChoices A map of choice keys to new choice texts. null means no choices.\n     * @returns {boolean} True if content was edited successfully, otherwise false.\n     */\n    updateContent(newText, newChoices = null) {\n        let edited = false;\n        if (typeof newText === 'string' && newText.trim() !== '') {\n            this.text = newText;\n            edited = true;\n        }\n\n        if(this.choicesAreEqual(newChoices)) {return edited;}\n\n        if (newChoices instanceof Map && newChoices) {\n            this.choices = newChoices;\n            edited = true;\n        } else if(newChoices === null) {\n            this.choices.clear();\n            edited = true;\n        }\n        return edited;\n    }\n\n    /**\n     * Updates the text of an existing choice.\n     * @param {string} next - Target scene ID.\n     * @param {string} newText - New description text.\n     * @returns {boolean} True if updated, false if not found.\n     */\n    updateChoiceText(next, newText) {\n        if (!this.choices.has(next)) return false;\n        this.choices.set(next, newText);\n        return true;\n    }\n\n    /**\n     * Removes a choice by its next key.\n     * @param {string} next - Target scene ID.\n     * @returns {boolean} True if removed, false if not found.\n     */\n    removeChoice(next) { return this.choices.delete(next); }\n\n    /**\n     * Returns all choices as an array of plain objects.\n     * @returns {Array<{text: string, next: string}>} List of choices.\n     */\n    getAllChoices()\n    {\n        return Array.from(this.choices, ([next, text]) => ({ text, next }));\n    }\n\n    /**\n     * Compares the scene's choices with a new set of choices.\n     * @param {Map<string, string>} newChoices - A map of new choice keys to new choice texts.\n     * @returns {boolean} true if the choices are the same, false otherwise.\n     */\n    choicesAreEqual(newChoices) {\n        if(!newChoices) {return false;}\n        if (this.choices.size !== newChoices.size) return false;\n\n        for (let [key, value] of this.choices) {\n            if (newChoices.get(key) !== value) return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Creates a new Scene instance from a JSON text.\n     * @returns {Scene | null} New Scene instance or null if parsing fails.\n     * @param {string} key\n     * @param {object|string} json\n     */\n    static fromJson(key,json)\n    {\n        if (!key || !json) return null;\n\n        let parsedObject = null;\n        // accept both raw string or parsed object\n        if (typeof json === 'string') {\n            try {\n                parsedObject = JSON.parse(json);\n            } catch (e) {\n                console.error(`Failed to parse JSON for scene ${key}: ${e}`);\n                return null;\n            }\n        } else if (typeof json === 'object') {\n            parsedObject = json;\n        } else {\n            console.error(`Failed to parse JSON for scene ${key}: Invalid JSON type`);\n            return null;\n        }\n        \n        if(!parsedObject.text || typeof parsedObject.text !== 'string'){\n            console.error(`Scene ${key} missing text property.`);\n            return null;\n        }\n\n        const scene = new Scene(key, parsedObject.text, null,[]);\n\n        // handle optional choices (leaf scenes may have none)\n        if (Array.isArray(parsedObject.choices)) {\n            for (const c of parsedObject.choices) {\n                if (!c || typeof c.text !== 'string' || typeof c.next !== 'string') continue;\n                scene.addChoice(c.text, c.next);\n            }\n        }\n\n        return scene;\n    }\n\n    /**\n     * Converts the scene into a plain JSON-compatible object.\n     * @returns {{text: string, choices: Array<{text: string, next: string}>}}\n     */\n    toJSON()\n    {\n        const choicesArray = [];\n        for (const [next, text] of this.choices.entries()) {\n            choicesArray.push({ text, next });\n        }\n        if(choicesArray.length === 0){\n            return { text: this.text };\n        }\n        return { text: this.text, choices: choicesArray };\n    }\n}\n\n/**\n * @typedef {Object} SceneRef\n * @property {Scene|null} scene - The referenced Scene instance, or null if missing.\n * @property {string} key - The scene key (ID)\n * @property {number} depth - Depth in the DFS traversal of the story tree, starting at 0 for the root scene.\n */", "import Scene from \"./Scene.js\";\n\n/**\n * Represents the entire story as an object-oriented tree of scenes.\n * Controls all scenes and ensures proper parent-child relationships.\n * Each scene (except the root) must have exactly one parent.\n */\nexport default class Story {\n    /**\n     * @constructor\n     */\n    constructor()\n    {\n        this.scenes = new Map(); // key -> Scene\n        this.root = null;        // start scene\n    }\n\n    /**\n     * Adds an existing Scene instance to the story.\n     * @param {Scene} scene - Scene object to add.\n     * @returns {boolean} True if added, false if duplicate Key.\n     */\n    addScene(scene)\n    {\n        if (this.scenes.has(scene.key)) return false;\n\n        this.scenes.set(scene.key, scene);\n        if (!this.root) {\n            this.root = scene;\n            return true;\n        } // first scene becomes root\n\n        if (!scene.parent && this.root && this.scenes.size > 0) {\n            const parent = this.findParent(scene.key);\n            if (parent) {\n                scene.parent = parent;\n                parent.addChoice(scene.text || `to ${scene.key}`, scene.key);\n            } else {\n                this.root.addChoice(scene.text || `to ${scene.key}`, scene.key);\n                scene.parent = this.root;\n            }\n        }\n\n        // ensure parent linkage integrity\n        if (scene.parent && this.scenes.has(scene.parent.key)) {\n            const parent = this.scenes.get(scene.parent.key);\n            parent.addChoice(scene.text || `to ${scene.key}`, scene.key);\n        }\n\n        return true;\n    }\n\n    /**\n     * Finds the parent Scene whose choices reference the given scene key.\n     * @param {string} sceneKey - Key of the scene to find a parent for.\n     * @returns {Scene|null} The parent Scene, or null if not found.\n     */\n    findParent(sceneKey) {\n        for (const scene of this.scenes.values()) {\n            if (scene.choices instanceof Map && scene.choices.has(sceneKey)) {\n                return scene;\n            }\n        }\n        return null;\n    }\n\n\n    /**\n     * Retrieves a scene by key.\n     * @param {string} key\n     * @returns {Scene|null}\n     */\n    getScene(key) { return this.scenes.get(key) || null; }\n\n    /**\n     * Depth of a scene relative to the root scene.\n     * @param {Map<string, Scene>} scenes - The map of scenes in the story (Key -> Scene).\n     * @param {Scene} scene - The scene whose depth needs to be calculated.\n     * @returns {number} The depth of the scene, -1 if the scene is not found.\n     */\n    static getSceneDepth(scenes, scene) {\n        if(! scenes.has(scene.key)){ return -1; }\n\n        let depth = 0;\n        let current = scene;\n        while (current && current.parent) {\n            depth++;\n            current = current.parent;\n        }\n        return depth;\n    }\n\n    /**\n     * Retrieves all scene references below start scene as array in depth-first order.\n     * starting from the given scene (defaults to root).\n     * @param {Story} story - The story instance containing the scenes.\n     * @param {Scene} [startScene=this.root]\n     * @returns {Array<SceneRef>} Array of { key, scene, depth }\n     */\n    static getScenesDFS(story, startScene = story.root)\n    {\n        if (!story || !startScene) return [];\n        /** @type {Array<SceneRef>} */\n        const result = [];\n        const stack = [];\n        const visited = new Set();\n\n        let baseDepth = 0;\n        if (startScene !== story.root) {\n            baseDepth = Story.getSceneDepth(story.scenes,startScene);\n        }\n        stack.push({ scene: startScene, depth: baseDepth });\n\n        // Use stack-based DFS traversal\n        while (stack.length > 0) {\n            const { scene, depth } = stack.pop();\n\n            // Skip already visited scenes to avoid revisiting and infloop\n            if(visited.has(scene.key)){ continue; }\n            visited.add(scene.key);\n            result.push({ key: scene.key, scene: scene,depth: depth });\n\n            // Add children to the stack in reverse order to maintain DFS order\n            const children = Array.from(scene.choices.keys())\n                .map(key => story.getScene(key))\n                .filter(child => child && !visited.has(child.key));\n            // Push in reverse order\n            for (let i = children.length - 1; i >= 0; i--) {\n                stack.push({ scene: children[i], depth: depth + 1 });\n            }\n        }\n        return result;\n    }\n\n    /**\n     * Checks if the story has a circle in the scene graph.\n     * @param {Story} story - The story instance containing the scenes.\n     * @returns {boolean} True if a cycle is found, false otherwise.\n     */\n    static hasCircle(story){\n        const visited = new Set();  // Set to track fully visited nodes\n        const scenes = Story.getScenesDFS(story);\n\n        // Iterate over the DFS results\n        for (const { scene } of scenes) {\n            if (!scene) continue;\n\n            // Check each scene's choices to see if we revisit a scene in the same DFS path\n            for (const nextKey of scene.choices.keys()) {\n                const nextScene = story.getScene(nextKey);\n                if (nextScene && visited.has(nextScene.key)) {\n                    // Cycle detected: revisited a scene already fully visited\n                    return true;\n                }\n            }\n\n            // Mark the current scene as fully visited\n            visited.add(scene.key);\n        }\n\n        // No cycles found\n        return false;\n    }\n\n    /**\n     * Edits the scene, including both the scene's text and its choices, only if there are differences.\n     * @param {string} key - The key of the scene to edit.\n     * @param {string} newText - The new scene text.\n     * @param {Map<string, string>} newChoices - A map of choice keys to new choice texts.\n     * @returns {boolean} true if the content was edited, false if no changes were made.\n     */\n    editScene(key, newText, newChoices) {\n        let scene = this.scenes.get(key);\n        if (!scene) {\n            console.warn(`Scene ${key} not found`);\n            return false;\n        }\n        return scene.updateContent(newText,newChoices);\n    }\n\n    /**\n     * Changes the parent of a scene.\n     * @param {string} key - Scene key to change.\n     * @param {string} newParentKey - New parent key.\n     * @returns {boolean} True if parent changed successfully, false if not found or invalid parent.\n     */\n    changeSceneParent(key, newParentKey)\n     {\n         let scene = this.scenes.get(key);\n         if(!scene){\n             console.warn(`Scene ${key} not found`);\n         }\n\n         let oldParentChoiceText = scene.parent.choices.get(scene.key).text;\n         scene.parent.removeChoice(scene.key);\n\n         const newParent = this.scenes.get(newParentKey);\n         if(! newParent){\n             scene.parent = null;\n             return false;\n         }\n         scene.parent = newParent;\n         newParent.addChoice(oldParentChoiceText || `to ${scene.key}`, scene.key);\n         return true;\n     }\n\n    /**\n     * Deletes a scene by key. Also deletes parent scene choices referencing this scene\n     * and recursively removes child scenes of this scene.\n     * @param {string} key\n     * @returns {boolean} True if found and deleted, else False\n     */\n    removeScene(key){\n        const scene = this.scenes.get(key);\n        if(!scene){\n            console.warn(`Scene ${key} not found`);\n            return false;\n        }\n\n        if(scene.parent){ scene.parent.removeChoice(scene.key); }\n\n        // Get all scenes below this scene (inclusive this one)\n        const allScenesBelow = Story.getScenesDFS(this, scene);\n\n        // in dfs order, parents come before children\n        // To be sure that child scenes are removed before parent, we use a reverse loop:\n        for (let i = allScenesBelow.length - 1; i >= 0; i--) {\n            const { key } = allScenesBelow[i];\n            this.scenes.delete(key);\n        }\n        return true;\n    }\n\n    /**\n     * Converts the entire story into a JSON-compatible structure.\n     * Each scene key maps to an object with `text` and `choices` array.\n     * @returns {Object<string, {text: string, choices: Array<{text: string, next: string}>}>}\n     */\n    toJSON()\n    {\n        const result = {};\n        for (const [key, scene] of this.scenes.entries()) {\n            result[key] = scene.toJSON();\n        }\n        return result;\n    }\n\n    /**\n     * Creates a new Story instance from a JSON Object.\n     * @param {Object} parsedJson\n     * @returns {Story | null} New Scene instance or null if parsing fails.\n     */\n    static fromJson(parsedJson) {\n        if (!parsedJson || typeof parsedJson !== 'object') { return null; }\n\n        let story = new Story(Scene);\n        for (const [key, value] of Object.entries(parsedJson)) {\n            const scene = Scene.fromJson(key, value);\n            if (scene) {\n                story.addScene(scene);\n            }else{\n                console.warn(`Failed to load scene ${key}`);\n                return null;\n            }\n        }\n        if (story.scenes.size === 0) {\n            console.warn('No scenes found in JSON');\n            return null;\n        }\n        return story;\n    }\n}", "import Story from \"./core/Story.js\";\n\nexport default class SaveLoad {\n    constructor() {\n        throw new Error('Static class');\n    }\n\n    /**\n     * Builds the story tree from plain JSON text.\n     * @param {string} filename\n     * @returns {Story | null | Promise<string>} Returns new story,null deserialization fails, or Promise<string> if loading fails.\n     */\n    static async loadFromJson(filename)\n    {\n        if (!filename || typeof filename !== 'string') {\n            return null;\n        }\n        let data = null;\n        try {\n            const response = await fetch(filename);\n            if (!response.ok) {\n                return null;\n            }\n            data = await response.json();\n        } catch (e) {\n            return null;\n        }\n\n        if (typeof Story.fromJson !== 'function') {\n            console.warn('Story has no method called: fromJson');\n            return null;\n        }\n        return Story.fromJson(data);\n    }\n\n    /**\n     * Saves the story tree as JSON text.\n     * @param {Story} story\n     * @param {string} filename\n     * @returns {boolean | Promise<boolean>}\n     */\n    static async saveToJson(story, filename)\n    {\n        if (!story || !filename || typeof filename !== 'string') {\n            console.error(\"Ung√ºltige Eingabeparameter in saveToJson: story = \", story, \", filename = \", filename);\n            return false;\n        }\n\n        const data = story.toJSON();\n        try {\n            let jsonStory = JSON.stringify(data)\n            const fileBlob = new Blob([jsonStory], { type: 'text/json' });\n\n            // Create a temporary link element\n            const link = document.createElement('a');\n            link.href = URL.createObjectURL(fileBlob);\n            link.download = filename;\n            // Programmatically click the link to trigger the download\n            link.click();\n            // Clean up the URL object\n            URL.revokeObjectURL(link.href);\n\n            console.log(\"Story saved to Json\");\n        }catch(e){\n            console.error(\"Failed to save story to Json:\" + e);\n            return false;\n        }\n        return true;\n    }\n\n    /**\n     * Saves a story as an executable HTML/CSS/JS file with which the story can be played in a browser.\n     * @param {string} filename\n     * @param {Story} story\n     * @returns {boolean | Promise<boolean>}\n     */\n    static async saveToHtml(story, filename)\n    {\n        if (!story || !filename || typeof filename !== 'string') {\n            console.error(\"Ung√ºltige Eingabeparameter in saveToHtml: story = \", story, \", filename = \", filename);\n            return false;\n        }\n\n        // base64 encoded viewer code parts, without encoding storing them as string without unintended escaping is hard\n        // ------------------------------------------- VIEWER TEMPLATE PART 1\n        const viewerPart1 = 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+U3RvcnktVmlld2VyPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICBib2R5IHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IHN5c3RlbS11aSwgc2Fucy1zZXJpZjsKICAgICAgICB9CiAgICAgICAgaDIgewogICAgICAgICAgICBjb2xvcjogIzBmMTcyYTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMC4yNXJlbTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjFmNWY5OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2JkNWUxOwogICAgICAgICAgICBwYWRkaW5nOiAxcmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICBtYXgtd2lkdGg6IDgwMHB4OwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjA2KTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgYnV0dG9uIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzNiODJmNjsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBwYWRkaW5nOiAwLjZyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDAuNXJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJnYW1lIj48L2Rpdj4KCjxzY3JpcHQ+CiAgICBjb25zdCBzdG9yeSA9IHsKICAgICAgICAvLyBJTlNFUlQgSlNPTiBTVE9SWSBIRVJFCg==';\n        // ------------------------------------------- VIEWER TEMPLATE PART 2\n        const viewerPart2 = 'ICAgIH07CgogICAgZnVuY3Rpb24gc2hvd1NjZW5lKGtleSkKICAgIHsKICAgICAgICBjb25zdCBzY2VuZSA9IHN0b3J5W2tleV07CiAgICAgICAgaWYgKCFzY2VuZSkgcmV0dXJuOwoKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2FtZSIpOwogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAiIjsgLy8gZGVsZXRlIHByZXZpb3VzIGNvbnRlbnQvc2NlbmUKCiAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJoMiIpOwogICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0ga2V5OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpOwoKICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBzY2VuZS50ZXh0OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dCk7CgogICAgICAgIGlmICghc2NlbmUuY2hvaWNlcyB8fCBzY2VuZS5jaG9pY2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICAgICAgICBmb3IgKGNvbnN0IGMgb2Ygc2NlbmUuY2hvaWNlcykgewogICAgICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gYy50ZXh0OwogICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBzaG93U2NlbmUoYy5uZXh0KSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgICAgfQogICAgfQoKICAgIHNob3dTY2VuZSgic3RhcnQiKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==';\n\n        const jsonObject = story.toJSON();\n        let jsonText = JSON.stringify(jsonObject);\n        jsonText = jsonText.slice(1,-1)\n\n        try {\n            const htmlText = window.atob(viewerPart1) + jsonText + window.atob(viewerPart2);\n            const fileBlob = new Blob([htmlText], { type: 'text/html' });\n\n            // Create a temporary link element\n            const link = document.createElement('a');\n            link.href = URL.createObjectURL(fileBlob);\n            link.download = filename;\n            // Programmatically click the link to trigger the download\n            link.click();\n            // Clean up the URL object\n            URL.revokeObjectURL(link.href);\n\n            console.log(\"Story saved to Html\");\n        }catch(e){\n            console.error(\"Failed to save story to Json:\" + e);\n            return false;\n        }\n        return true;\n    }\n\n    /**\n     * Saves a story as an encrypted HTML file with obfuscation against scraping.\n     * @param {Story} story\n     * @param {string} filename\n     * @param {string} encryptionKey - Password for XOR encryption\n     * @returns {boolean | Promise<boolean>}\n     */\n    static async saveToEncryptedHtml(story, filename, encryptionKey){\n        if (!story || !filename || typeof filename !== 'string' || !encryptionKey) {\n            console.error(\"Ung√ºltige Parameter in saveToEncryptedHtml\");\n            return false;\n        }\n\n        // obfuscatedViewer-Template-Parts (base64)\n        const encryptedViewerPart1 = 'PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+T2JmdXNjYXRlZCBTdG9yeS1WaWV3ZXI8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIGJvZHkgewogICAgICAgICAgICBmb250LWZhbWlseTogc3lzdGVtLXVpLCBzYW5zLXNlcmlmOwogICAgICAgIH0KICAgICAgICBoMiB7CiAgICAgICAgICAgIGNvbG9yOiAjMGYxNzJhOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwLjI1cmVtOwogICAgICAgIH0KICAgICAgICAjZ2FtZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmMWY1Zjk7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjYmQ1ZTE7CiAgICAgICAgICAgIHBhZGRpbmc6IDFyZW07CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgbWFyZ2luOiAwIGF1dG87CiAgICAgICAgICAgIG1heC13aWR0aDogODAwcHg7CiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDAsMCwwLDAuMDYpOwogICAgICAgIH0KICAgICAgICAjZ2FtZSBidXR0b24gewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjM2I4MmY2OwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIHBhZGRpbmc6IDAuNnJlbSAxcmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMC41cmVtOwogICAgICAgICAgICBmb250LXdlaWdodDogNTAwOwogICAgICAgIH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgaWQ9ImdhbWUiPjwvZGl2PgoKPHNjcmlwdD4KICAgIC8vID09PSBjb25maWcgPT09CiAgICBjb25zdCBFTkNSWVBURURfU1RPUlkgPSAi';\n        const encryptedViewerPart2 = 'IjsKICAgIGNvbnN0IERFQ1JZUFRJT05fS0VZID0gIg=='; // part after \"ENCRYPTED_STORY\"\n        const encryptedViewerPart3 = 'IjsKCiAgICBsZXQgc3RvcnkgPSBudWxsOwoKICAgIGZ1bmN0aW9uIHNob3dTY2VuZShrZXkpCiAgICB7CiAgICAgICAgY29uc3Qgc2NlbmUgPSBzdG9yeVtrZXldOwogICAgICAgIGlmICghc2NlbmUpIHJldHVybjsKCiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImdhbWUiKTsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gIiI7IC8vIGRlbGV0ZSBwcmV2aW91cyBjb250ZW50L3NjZW5lCgogICAgICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaDIiKTsKICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IGtleTsgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTsKCiAgICAgICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKTsKICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gc2NlbmUudGV4dDsgY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHQpOwoKICAgICAgICBpZiAoIXNjZW5lLmNob2ljZXMgfHwgc2NlbmUuY2hvaWNlcy5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICAgICAgZm9yIChjb25zdCBjIG9mIHNjZW5lLmNob2ljZXMpIHsKICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGMudGV4dDsKICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gc2hvd1NjZW5lKGMubmV4dCkpOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBYT1IgZGVjcnlwdGlvbiB3aXRoIHBvc2l0aW9uIG1peGluZwogICAgZnVuY3Rpb24gZGVjcnlwdFN0b3J5KGVuY3J5cHRlZEhleCwga2V5KSB7CiAgICAgICAgaWYoIWVuY3J5cHRlZEhleCB8fCBlbmNyeXB0ZWRIZXgubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVuY3J5cHRlZCBzdG9yeSBvciBrZXkgbm90IGZvdW5kLiIpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gSGV4IGRlY29kZQogICAgICAgICAgICBjb25zdCBlbmNyeXB0ZWQgPSBuZXcgVWludDhBcnJheShlbmNyeXB0ZWRIZXgubGVuZ3RoIC8gMik7CiAgICAgICAgICAgIGxldCBieXRlSW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVuY3J5cHRlZEhleC5sZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICAgICAgZW5jcnlwdGVkW2J5dGVJbmRleCsrXSA9IHBhcnNlSW50KGVuY3J5cHRlZEhleC5zbGljZShpLCBpICsgMiksIDE2KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3Qga2V5Qnl0ZXMgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoa2V5KTsKCiAgICAgICAgICAgIGNvbnN0IGRlY3J5cHRlZCA9IG5ldyBVaW50OEFycmF5KGVuY3J5cHRlZC5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVuY3J5cHRlZC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZGVjcnlwdGVkW2ldID0gZW5jcnlwdGVkW2ldIF4ga2V5Qnl0ZXNbaSAlIGtleUJ5dGVzLmxlbmd0aF0gXiAoaSAmIDB4RkYpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGRlY3J5cHRlZCk7CiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGpzb25TdHJpbmcpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRGVjcnlwdGlvbiBvZiBzdG9yeSBmYWlsZWQ6IiwgZSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBJbml0aWFsaXplIGdhbWUgd2l0aCBhc3luYy9hd2FpdAogICAgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUdhbWUoKSB7CiAgICAgICAgY29uc29sZS5sb2coIkluaXRpYWxpemluZyBnYW1lLi4uIik7CgogICAgICAgIHN0b3J5ID0gYXdhaXQgZGVjcnlwdFN0b3J5KEVOQ1JZUFRFRF9TVE9SWSwgREVDUllQVElPTl9LRVkpOwogICAgICAgIHN0b3J5ID0gSlNPTi5wYXJzZShzdG9yeSk7CiAgICAgICAgCiAgICAgICAgaWYgKCFzdG9yeSkgewogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2FtZSIpOwogICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gIjxwPkVycm9yOiBDb3VsZCBub3QgbG9hZCB0aGUgc3RvcnkuPC9wPiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnNvbGUubG9nKCJEaXNwbGF5aW5nIGZpcnN0IHNjZW5lLi4uIik7CiAgICAgICAgc2hvd1NjZW5lKCJzdGFydCIpOwogICAgfQoKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7CiAgICAgICAgaW5pdGlhbGl6ZUdhbWUoKS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGluaXRpYWxpemluZyBnYW1lOiIsIGVycm9yKTsKICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImdhbWUiKTsKICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICI8cD5BbiBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIGNoZWNrIHRoZSBjb25zb2xlIGZvciBkZXRhaWxzLjwvcD4iOwogICAgICAgIH0pOwogICAgfSk7CgogICAgc3RvcnkgPSBkZWNyeXB0U3RvcnkoRU5DUllQVEVEX1NUT1JZLCBERUNSWVBUSU9OX0tFWSk7CiAgICBzaG93U2NlbmUoInN0YXJ0Iik7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4='; // part after \"DECRYPTION_KEY\"\n\n        const jsonObject = story.toJSON();\n        const jsonString = JSON.stringify(jsonObject);\n        const encryptedStory = SaveLoad.#encryptStory(jsonString, encryptionKey);\n\n        try {\n            // Construct html story file\n            const htmlText =\n                window.atob(encryptedViewerPart1) +\n                `${encryptedStory}` +  // Encrypted Hex-String\n                window.atob(encryptedViewerPart2) +\n                `${encryptionKey}` +   // Key\n                window.atob(encryptedViewerPart3);\n\n            const fileBlob = new Blob([htmlText], { type: 'text/html' });\n            const link = document.createElement('a');\n            link.href = URL.createObjectURL(fileBlob);\n            link.download = filename;\n            link.click();\n            URL.revokeObjectURL(link.href);\n\n            console.log(\"Encrypted story saved to HTML\");\n            return true;\n        } catch(e) {\n            console.error(\"Failed to save encrypted story: \" + e);\n            return false;\n        }\n    }\n\n    static #encryptStory(storyObject, key) {\n        const jsonString = JSON.stringify(storyObject);\n        const utf8Bytes = new TextEncoder().encode(jsonString);\n        const keyBytes = new TextEncoder().encode(key);\n\n        const encrypted = new Uint8Array(utf8Bytes.length);\n        for (let i = 0; i < utf8Bytes.length; i++) {\n            encrypted[i] = utf8Bytes[i] ^ keyBytes[i % keyBytes.length] ^ (i & 0xFF);\n        }\n\n        let hexString = '';\n        for (let i = 0; i < encrypted.length; i++) {\n            const hex = encrypted[i].toString(16).padStart(2, '0');\n            hexString += hex;\n        }\n        return hexString;\n    }\n}", "import Story from \"./core/Story.js\";\n\nexport default class AsciiTreeRenderer {\n    /**\n     * Generates the story tree as an ASCII-style string.\n     * Marks missing (unresolved) scenes explicitly.\n     * @param {Story} story - The story object containing the scenes.\n     * @param {HTMLElement} parentElement Element inside which the output will be inserted.\n     */\n    static generateTreeAscii(story,parentElement = document.getElementById('tree-output')) {\n        console.log(\"StoryTreeRenderer.generateTreeAscii. Parent: \" + parentElement.id + \" Story: \" + story.root.key);\n        if (!parentElement) return;\n        if (!story || !story.root) {\n            parentElement.textContent = '(noch kein Baum erstellt)';\n            return;\n        }\n\n        const scenesWithDepth = Story.getScenesDFS(story,story.root);\n        const outputLines = [];\n        for (let i = 0; i < scenesWithDepth.length; i++) {\n            let { key, scene, depth } = scenesWithDepth[i];\n\n            // Tree-prefix (Indentation with ASCII)\n            let prefix = '';\n            for (let d = 0; d < depth; d++) {\n                prefix += (d === depth - 1) ? '|_ ' : '   ';\n            }\n            key = String(key); // ensure its string\n\n            if (scene === null) {\n                outputLines.push(prefix + '[' + key + ']' + \"(MISSING)\");\n            } else {\n                outputLines.push(prefix + key);\n            }\n        }\n        const output = outputLines.join('\\n');\n        parentElement.textContent = output;\n    }\n}", "/**\n * UI feedback helper.\n */\nexport default class Feedback {\n    /**\n     * Displays a temporary feedback message in the UI.\n     * @param {string} message - The message to display.\n     * @param {HTMLElement} targetElement - The HTML element where the message will be added.\n     * @param {boolean} isSuccess - Determines if the message is a success or error.\n     * @param {string} mode - Determines how the message is handled ('create' or 'set').\n     */\n    static show(message, targetElement, isSuccess, mode = 'create') {\n        if (!targetElement) return;\n\n        const feedbackClass = isSuccess ? 'feedback-success' : 'feedback-error';\n\n        if (mode === 'create') {\n            const notice = document.createElement('div');\n            notice.textContent = message;\n            notice.classList.add('feedback', feedbackClass);\n            targetElement.appendChild(notice);\n            setTimeout(() => notice.remove(), 3000);\n        } else if (mode === 'set') {\n            targetElement.textContent = message;\n            targetElement.classList.add('feedback', feedbackClass);\n        }\n    }\n}\n", "/**\n * Responsible for rendering a scene to the play area.\n */\nexport default class SceneRenderer {\n    /**\n     * Render a scene by key.\n     * @param {import('./Story.js').default} story\n     * @param {string} key\n     * @param {string} targetElementId\n     */\n    static render(story, key, targetElementId = 'play-area') {\n        const area = document.getElementById(targetElementId);\n        if (!area) return;\n\n        const scene = story.getScene(key);\n        area.innerHTML = '';\n\n        if (!scene) {\n            const errorMessage = document.createElement('p');\n            const em = document.createElement('em');\n            em.textContent = \"Szene '\" + key + \"' nicht gefunden.\";\n            errorMessage.appendChild(em);\n            area.textContent = '';\n            area.appendChild(errorMessage);\n            return;\n        }\n\n        const sceneTitle = document.createElement('p');\n        const sceneKeyStrong = document.createElement('strong');\n        sceneKeyStrong.textContent = key;\n        sceneTitle.append(sceneKeyStrong, \": \" + scene.text);\n\n        area.appendChild(sceneTitle);\n\n        for (const [next, text] of scene.choices.entries()) {\n            const button = document.createElement('button');\n            button.textContent = text;\n            button.onclick = () => SceneRenderer.render(story, next, targetElementId);\n            area.appendChild(button);\n            area.appendChild(document.createElement('br'));\n        }\n    }\n}\n", "/**\n * Renders an HTML tree of the story structure with expandable/collapsible nodes.\n * Does not modify the story; maintains only UI state (expanded nodes).\n */\nexport default class TreeEditor {\n    // Keep one instance per target container id to preserve expand/collapse state across renders\n    static #instances = new Map();\n\n    static #getInstance(targetElementId) {\n        if (!this.#instances.has(targetElementId)) {\n            this.#instances.set(targetElementId, new TreeEditor(targetElementId));\n        }\n        return this.#instances.get(targetElementId);\n    }\n\n    /**\n     * Convenience static: delegate to instance to keep state.\n     * @param {import('./core/Story.js').default} story\n     * @param {string} targetElementId\n     */\n    static render(story, targetElementId = 'tree-html-area') {\n        const inst = TreeEditor.#getInstance(targetElementId);\n        inst.render(story);\n    }\n\n    constructor(targetElementId) {\n        this.targetElementId = targetElementId;\n        // Track expanded scene keys. Root will be expanded on first render.\n        this.expanded = new Set();\n    }\n\n    /**\n     * Render the story as a nested HTML list inside target container.\n     * Previous content will be removed before rendering.\n     * @param {import('./core/Story.js').default} story\n     */\n    render(story) {\n        const container = this.#getContainer();\n        if (!container) return;\n\n        this.#clear(container);\n\n        if (!this.#hasValidRoot(story)) {\n            this.#appendNoRootMessage(container);\n            return;\n        }\n\n        this.#ensureRootExpanded(story);\n\n        const ul = this.#createRootList();\n        this.#renderNode(story.root.key, ul, story, new Set());\n        container.appendChild(ul);\n    }\n\n    // ===== Helper methods (private) =====\n\n    #getContainer() {\n        const container = document.getElementById(this.targetElementId);\n        if (!container) {\n            console.warn(`TreeEditor: container with id \"${this.targetElementId}\" not found.`);\n        }\n        return container;\n    }\n\n    #clear(container) {\n        container.innerHTML = '';\n    }\n\n    #hasValidRoot(story) {\n        return !!(story && story.root);\n    }\n\n    #appendNoRootMessage(container) {\n        const p = document.createElement('p');\n        p.textContent = 'Keine Startszene gefunden. Lege zuerst eine Szene mit dem Schl√ºssel \"start\" an.';\n        container.appendChild(p);\n    }\n\n    #ensureRootExpanded(story) {\n        if (!this.expanded.has(story.root.key)) {\n            this.expanded.add(story.root.key);\n        }\n    }\n\n    #createRootList() {\n        const ul = document.createElement('ul');\n        ul.classList.add('story-tree');\n        return ul;\n    }\n\n    #renderNode(sceneKey, parentUl, story, path) {\n        const li = document.createElement('li');\n        const scene = story.getScene(sceneKey);\n\n        if (!scene) {\n            li.textContent = `${sceneKey} (Szene nicht gefunden)`;\n            const addButton = this.#createAddButton(sceneKey, story);\n            addButton.classList.add('tree-addscene-btn');\n            li.appendChild(addButton);\n            parentUl.appendChild(li);\n            return;\n        }\n\n        const header = this.#createNodeHeader(sceneKey, scene, story);\n        li.appendChild(header);\n        parentUl.appendChild(li);\n\n        // Cycle detection\n        if (path.has(sceneKey)) {\n            const cycleNote = document.createElement('em');\n            cycleNote.textContent = ' (Zyklus)';\n            li.appendChild(cycleNote);\n            return;\n        }\n\n        if (!this.#hasChildren(scene)) return;\n\n        const isExpanded = this.#isExpanded(sceneKey);\n        if (!isExpanded) return; // collapsed\n\n        const childUl = document.createElement('ul');\n        li.appendChild(childUl);\n\n        const nextPath = new Set(path);\n        nextPath.add(sceneKey);\n\n        for (const [nextKey, choiceText] of scene.choices.entries()) {\n            const edgeLi = document.createElement('li');\n            const edgeLabel = document.createElement('span');\n            edgeLabel.classList.add('tree-edge');\n            edgeLabel.textContent = `‚Üí ${choiceText}`;\n            edgeLi.appendChild(edgeLabel);\n\n            const nestedUl = document.createElement('ul');\n            edgeLi.appendChild(nestedUl);\n            childUl.appendChild(edgeLi);\n\n            this.#renderNode(nextKey, nestedUl, story, nextPath);\n        }\n    }\n\n    #createNodeHeader(sceneKey, scene, story) {\n        const header = document.createElement('div');\n        header.classList.add('tree-node-header');\n        const isRoot = story && story.root && story.root.key === sceneKey;\n\n        // Toggle only for non-root nodes that have children\n        if (!isRoot && this.#hasChildren(scene)) {\n            const btn = this.#createToggleButton(sceneKey, story);\n            header.appendChild(btn);\n        } else {\n            header.appendChild(this.#createToggleSpacer());\n        }\n\n        const label = this.#createLabel(sceneKey, scene);\n        header.appendChild(label);\n\n        // Delete button (non-root only)\n        if (!isRoot) {\n            const delBtn = this.#createDeleteButton(sceneKey, story);\n            // Platzierung: direkt in/bei der Node (neben dem Label), nicht ganz rechts\n            label.appendChild(delBtn);\n        }\n        return header;\n    }\n\n    #createToggleButton(sceneKey, story) {\n        const isExpanded = this.#isExpanded(sceneKey);\n        const btn = document.createElement('button');\n        btn.classList.add('tree-toggle');\n        btn.setAttribute('aria-label', isExpanded ? 'Einklappen' : 'Ausklappen');\n        btn.setAttribute('aria-expanded', String(isExpanded));\n        btn.textContent = isExpanded ? '‚àí' : '+';\n        btn.addEventListener('click', (e) => this.#onToggleClick(e, sceneKey, story));\n        return btn;\n    }\n\n    #createToggleSpacer() {\n        const spacer = document.createElement('span');\n        spacer.classList.add('tree-toggle-spacer');\n        return spacer;\n    }\n\n    #createLabel(sceneKey, scene) {\n        const label = document.createElement('span');\n        label.classList.add('tree-node');\n        const strong = document.createElement('strong');\n        strong.textContent = sceneKey;\n        label.appendChild(strong);\n        return label;\n    }\n\n    #createDeleteButton(sceneKey, story) {\n        const btn = document.createElement('button');\n        btn.classList.add('tree-delete');\n        btn.setAttribute('aria-label', `Szene \"${sceneKey}\" l√∂schen`);\n        btn.textContent = 'üóë';\n        btn.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const ok = confirm(`Soll die Szene \"${sceneKey}\" wirklich gel√∂scht werden?`);\n            if (!ok) return;\n            const success = story.removeScene(sceneKey);\n            if (!success) {\n                console.warn(`TreeEditor: Szene \"${sceneKey}\" konnte nicht gel√∂scht werden.`);\n                return;\n            }\n            // Cleanup expansion state of the removed node\n            this.expanded.delete(sceneKey);\n            // Re-render tree after deletion\n            this.render(story);\n        });\n        return btn;\n    }\n\n    #createAddButton(sceneKey) {\n        const btn = document.createElement('button');\n        btn.classList.add('tree-add');\n        btn.setAttribute('aria-label', `Szene \"${sceneKey}\" hinzuf√ºgen`);\n        btn.textContent = '+';\n        btn.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const sceneKeyTextfield = document.getElementById(\"creator-scene-key\");\n            sceneKeyTextfield.value = sceneKey;\n            const popup = document.getElementById(\"create-scene-popup\");\n            popup.style.display = \"block\";\n        });\n        return btn;\n    }\n\n    #onToggleClick(e, sceneKey, story) {\n        e.preventDefault();\n        e.stopPropagation();\n        this.#toggleExpanded(sceneKey);\n        this.render(story); // re-render full tree\n    }\n\n    #hasChildren(scene) {\n        return !!(scene.choices && scene.choices.size);\n    }\n\n    #isExpanded(sceneKey) {\n        return this.expanded.has(sceneKey);\n    }\n\n    #toggleExpanded(sceneKey) {\n        if (this.expanded.has(sceneKey)) this.expanded.delete(sceneKey);\n        else this.expanded.add(sceneKey);\n    }\n}\n", "import AsciiTreeRenderer from \"./AsciiTreeRenderer.js\";\nimport Feedback from \"./Feedback.js\";\nimport SceneRenderer from \"./SceneRenderer.js\";\nimport Scene from \"./core/Scene.js\";\nimport Story from \"./core/Story.js\";\nimport TreeEditor from \"./TreeEditor.js\";\n\n/**\n * Editor used by the form-based story builder.\n * Holds a reference to the Story instance\n */\nexport default class SceneEditor {\n    /**\n     * @param {Story} storyInstance - The story instance to be edited.\n     */\n    constructor(storyInstance) {\n        this.story = storyInstance;\n    }\n\n    /**\n     * Adds a new scene to the story.\n     * @param {Story} story\n     * @returns void\n     */\n    static addScene(story) {\n        const sceneKey = document.getElementById('creator-scene-key').value.trim();\n        const text = document.getElementById('creator-scene-text').value.trim();\n        const editorSection = document.getElementById('scene-creator');\n\n        if (!sceneKey || !text) {\n            Feedback.show(\"Bitte Schl√ºssel und Text ausf√ºllen.\", editorSection, false);\n            return;\n        }\n\n        const creatorChoicesContainer = document.getElementById('creator-choices-container');\n        const choiceElements = Array.from(creatorChoicesContainer.querySelectorAll('.choice-inputs'));\n        const choices = new Map();\n        choiceElements.forEach(el => {\n            const textInput = el.querySelector('.choice-text');\n            const nextInput = el.querySelector('.choice-next');\n            if(! nextInput) {\n                console.log(\"No input for next scene key found. \");\n            }\n            const text = textInput.value.trim();\n            const next = nextInput.value.trim();\n            if (text && next) choices.set(next, text);\n        });\n\n        if (!story.addScene(new Scene(sceneKey, text, null, choices))) {\n            Feedback.show(\"Scene could not be added to story, key already exists.\", editorSection, false);\n            return;\n        }\n        SceneRenderer.render(story, sceneKey);\n        AsciiTreeRenderer.generateTreeAscii(story);\n        TreeEditor.render(story);\n\n        // Eingabefelder leeren\n        document.getElementById('creator-scene-key').value = \"\";\n        document.getElementById('creator-scene-text').value = \"\";\n        const choicesContainer = document.getElementById('creator-choices-container');\n        choicesContainer.innerHTML = `<div class=\"choice-inputs\">\n    <input type=\"text\" class=\"choice-text\" placeholder=\"Entscheidungstext\">\n    <input type=\"text\" class=\"choice-next\" placeholder=\"N√§chste Szene (Schl√ºssel)\">\n    </div>`;\n\n        Feedback.show(`Szene wurde gespeichert.`, editorSection, true)\n    }\n\n    /**\n     * @param {Story} story\n     */\n    static editScene(story) {\n        const keyInput = document.getElementById(\"editor-scene-key\");\n        const status = document.getElementById(\"editor-scene-status\");\n        const textInput = document.getElementById(\"editor-scene-text\");\n        const choicesContainer = document.getElementById(\"editor-choices-container\");\n        const key = keyInput.value.trim();\n        const text = textInput.value.trim();\n\n        if (!key) {\n            Feedback.show(\"Bitte gib den Schl√ºssel der zu bearbeitenden Szene ein.\", status, false);\n            return;\n        }\n\n        let choices = new Map();\n        for (const el of choicesContainer.children) {\n            if (!el.classList.contains('choice-inputs')) continue;\n\n            let choiceTextInput = el.querySelector(\".choice-text\");\n            let choiceKeyInput = el.querySelector(\".choice-next\");\n\n            if (!choiceTextInput || !choiceKeyInput\n                || !(choiceTextInput instanceof HTMLInputElement) || !(choiceKeyInput instanceof HTMLInputElement)) {\n                console.log(\"Error in editScene: Invalid choice input elements. Skipping choice.\");\n                continue;\n            }\n            let choiceKey = choiceKeyInput.value.trim();\n            let choiceText = choiceTextInput.value.trim();\n            if( !choiceKey ) continue;\n            choices.set(choiceKey, choiceText);\n        }\n\n        let success = story.editScene(key, text, choices);\n        if (success) {\n            SceneRenderer.render(story, key);\n            Feedback.show(`Szene wurde erfolgreich bearbeitet.`, status, true);\n        }\n    }\n\n    /**\n     * Adds a new choice field to the choices container.\n     * @param {HTMLElement} parentElement\n     * @returns void\n     */\n    static addChoiceField(parentElement) {\n        if (!parentElement) {\n            console.error('parentElement is not found.');\n            return;\n        }\n\n        const container = document.createElement('div');\n        container.className = 'choice-inputs';\n        container.innerHTML = `\n        <input type=\"text\" class=\"choice-text\" placeholder=\"Entscheidungstext\">\n        <input type=\"text\" class=\"choice-next\" placeholder=\"N√§chste Szene (Schl√ºssel)\">\n      `;\n        container.appendChild(SceneEditor.#createDeleteButton(container));\n        parentElement.appendChild(container);\n    }\n\n    /**\n     * A delete btn that deletes one choice input form with 2 textinputs\n     * @param {HTMLDivElement} choiceInputsContainer\n     * @returns {HTMLButtonElement}\n     */\n    static #createDeleteButton(choiceInputsContainer) {\n        const btn = document.createElement('button');\n        btn.classList.add('choiceform-delete');\n        btn.setAttribute('aria-label', `Choice l√∂schen`);\n        btn.textContent = 'üóë';\n        btn.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            choiceInputsContainer.remove();\n        });\n        return btn;\n    }\n}\n", "import Scene from './core/Scene.js';\nimport Story from \"./core/Story.js\";\nimport SaveLoad from \"./SaveLoad.js\";\nimport AsciiTreeRenderer from './AsciiTreeRenderer.js';\nimport SceneEditor from './SceneEditor.js';\nimport SceneRenderer from './SceneRenderer.js';\nimport Feedback from './Feedback.js';\nimport TreeEditor from './TreeEditor.js';\n\nlet story = new Story(Scene);\nlet formEditor = new SceneEditor(story);\n\nfunction startStory()\n{\n    if (!story.root) {\n        alert(\"Keine 'start'-Szene gefunden.\");\n        return;\n    }\n    SceneRenderer.render(story, \"start\");\n}\n\n/**\n * Imports a story from a JSON file.\n * @returns void\n */\nasync function importStory() {\n    const fileInput = document.getElementById(\"json-file\");\n    const importStatus = document.getElementById(\"import-status\");\n    if (!fileInput.files.length) {\n        Feedback.show(\"Bitte zuerst eine JSON-Datei ausw√§hlen.\", importStatus, false);\n        return;\n    }\n\n    const file = fileInput.files[0];\n    const fileUrl = URL.createObjectURL(file);\n\n    try {\n        story = await SaveLoad.loadFromJson(fileUrl, Scene, Story);\n        if(!story){\n            importStatus.textContent = \"Fehler beim Laden: Story konnte nicht geladen werden.\";\n            return;\n        }\n        // update editor story reference\n        formEditor.story = story;\n        Feedback.show(`\"${file.name}\" erfolgreich geladen (${story.scenes.size} Szenen).`, importStatus, true);\n\n        AsciiTreeRenderer.generateTreeAscii(story);\n        // Nach externen Aktionen (z. B. Import) auch den Tree‚ÄëEditor aktualisieren\n        TreeEditor.render(story);\n        startStory();\n    } catch (err) {\n        Feedback.show(\"Fehler beim Laden: \" + err.message, importStatus, false);\n    } finally {\n        URL.revokeObjectURL(fileUrl);\n    }\n}\n\n/**\n * Exports the current story to a JSON file.\n * @returns void\n */\nfunction exportToJson() {\n    if (!story) {\n        Feedback.show(\"No story available to export.\", document.getElementById(\"import-status\"), false);\n        return;\n    }\n    let success = SaveLoad.saveToJson(story, \"story.json\");\n    if(success) Feedback.show(\"Story successfully exported to JSON.\", document.getElementById(\"import-status\"), true);\n}\n\n/**\n * Exports the current story to an HTML file.\n * @returns void\n * @param asEncrypted\n */\nfunction exportToHtml(asEncrypted) {\n    if (!story) {\n        Feedback.show(\"No story available to export.\", document.getElementById(\"import-status\"), false);\n        return;\n    }\n    let success = false;\n    if(asEncrypted) {\n        success = SaveLoad.saveToEncryptedHtml(story, \"story.html\",\"9oj7k&7C@b@W\");\n    }else{\n        success = SaveLoad.saveToHtml(story, \"story.html\");\n    }\n    if(success) Feedback.show(\"Story successfully exported to HTML.\", document.getElementById(\"import-status\"), true);\n}\n\nfunction applyTheme(theme) {\n    if (theme === \"default\") {\n        document.documentElement.removeAttribute(\"data-theme\");\n    } else {\n        document.documentElement.setAttribute(\"data-theme\", theme);\n    }\n}\n\nfunction initializePopup() {\n    const initPopup = (popupId, showBtnId, closeBtnId, addChoiceBtnId, submitBtnId, choicesContainerId, action) => {\n        const popup = document.getElementById(popupId);\n        const showBtn = document.getElementById(showBtnId);\n        const closeBtn = document.getElementById(closeBtnId);\n        const addChoiceBtn = document.getElementById(addChoiceBtnId);\n        const choicesContainer = document.getElementById(choicesContainerId);\n        const submitBtn = document.getElementById(submitBtnId);\n\n        showBtn.addEventListener(\"click\", function () {\n            popup.style.display = \"block\";\n        });\n        closeBtn.addEventListener(\"click\", function () {\n            popup.style.display = \"none\";\n        });\n        window.addEventListener(\"click\", function (event) {\n            if (event.target === popup) {\n                popup.style.display = \"none\";\n            }\n        });\n\n        addChoiceBtn.addEventListener(\"click\", function () {\n            SceneEditor.addChoiceField(choicesContainer);\n        });\n        submitBtn.addEventListener(\"click\", function () {\n            action();\n            popup.style.display = \"none\";\n        });\n    }\n\n    initPopup(\"create-scene-popup\", \"showCreatorBtn\", \"creator-closeBtn\", \"creator-add-choice-btn\", \"creator-submit-btn\", \"creator-choices-container\", function() {\n        SceneEditor.addScene(story);\n    });\n\n    initPopup(\"edit-scene-popup\", \"showEditorBtn\", \"editor-closeBtn\", \"editor-add-choice-btn\", \"editor-submit-btn\", \"editor-choices-container\", function() {\n        SceneEditor.editScene(story);\n    });\n}\n\n// make helper functions available for onclick to HTML file\nwindow.renderScene = (key) => SceneRenderer.render(story, key);\nwindow.removeScene = () => formEditor.removeScene();\n\n// Register functions\nwindow.addEventListener(\"DOMContentLoaded\", () => {\n    console.log(\"page is fully loaded\");\n\n    document.getElementById('start-story').addEventListener('click', startStory);\n    document.getElementById(\"btn-ascii-tree-refresh\").addEventListener(\"click\", () => {\n        AsciiTreeRenderer.generateTreeAscii(story);\n    });\n    const btnHtmlTree = document.getElementById('btn-html-tree-refresh');\n    if (btnHtmlTree) {\n        btnHtmlTree.addEventListener('click', () => TreeEditor.render(story));\n    }\n\n    // --- JSON Import/Export Button Events ---\n    document.getElementById(\"import-json\").addEventListener(\"click\", importStory);\n    document.getElementById(\"export-json\").addEventListener(\"click\", exportToJson);\n    document.getElementById(\"export-html\").addEventListener(\"click\", () => {\n        const protectStory = document.getElementById(\"export-antiscraping-check\").checked;\n        exportToHtml(protectStory);\n    });\n\n    // --- Design\n    document.getElementById(\"theme-select\").addEventListener(\"change\", function() {\n        applyTheme(this.value);\n    });\n    initializePopup();\n});"],
  "mappings": "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",
  "names": ["Scene", "_Scene", "key", "text", "parent", "choices", "next", "choiceText", "newText", "newChoices", "edited", "value", "json", "parsedObject", "e", "scene", "choicesArray", "Story", "_Story", "scene", "parent", "sceneKey", "key", "scenes", "depth", "current", "story", "startScene", "result", "stack", "visited", "baseDepth", "children", "child", "i", "nextKey", "nextScene", "newText", "newChoices", "newParentKey", "oldParentChoiceText", "newParent", "allScenesBelow", "parsedJson", "Scene", "value", "SaveLoad", "_SaveLoad", "filename", "data", "response", "Story", "story", "jsonStory", "fileBlob", "link", "e", "viewerPart1", "viewerPart2", "jsonObject", "jsonText", "htmlText", "encryptionKey", "encryptedViewerPart1", "encryptedViewerPart2", "encryptedViewerPart3", "jsonString", "encryptedStory", "#encryptStory", "storyObject", "key", "utf8Bytes", "keyBytes", "encrypted", "hexString", "hex", "AsciiTreeRenderer", "story", "parentElement", "scenesWithDepth", "Story", "outputLines", "i", "key", "scene", "depth", "prefix", "d", "output", "Feedback", "message", "targetElement", "isSuccess", "mode", "feedbackClass", "notice", "SceneRenderer", "_SceneRenderer", "story", "key", "targetElementId", "area", "scene", "errorMessage", "em", "sceneTitle", "sceneKeyStrong", "next", "text", "button", "TreeEditor", "_TreeEditor", "#instances", "#getInstance", "targetElementId", "story", "container", "#getContainer", "#clear", "#hasValidRoot", "#appendNoRootMessage", "#ensureRootExpanded", "ul", "#createRootList", "#renderNode", "p", "sceneKey", "parentUl", "path", "li", "scene", "addButton", "#createAddButton", "header", "#createNodeHeader", "cycleNote", "#hasChildren", "#isExpanded", "childUl", "nextPath", "nextKey", "choiceText", "edgeLi", "edgeLabel", "nestedUl", "isRoot", "btn", "#createToggleButton", "#createToggleSpacer", "label", "#createLabel", "delBtn", "#createDeleteButton", "isExpanded", "e", "#onToggleClick", "spacer", "strong", "sceneKeyTextfield", "popup", "#toggleExpanded", "SceneEditor", "_SceneEditor", "storyInstance", "story", "sceneKey", "text", "editorSection", "Feedback", "creatorChoicesContainer", "choiceElements", "choices", "el", "textInput", "nextInput", "next", "Scene", "SceneRenderer", "AsciiTreeRenderer", "TreeEditor", "choicesContainer", "keyInput", "status", "key", "choiceTextInput", "choiceKeyInput", "choiceKey", "choiceText", "parentElement", "container", "#createDeleteButton", "choiceInputsContainer", "btn", "e", "story", "Story", "Scene", "formEditor", "SceneEditor", "startStory", "SceneRenderer", "importStory", "fileInput", "importStatus", "Feedback", "file", "fileUrl", "SaveLoad", "AsciiTreeRenderer", "TreeEditor", "err", "exportToJson", "exportToHtml", "asEncrypted", "success", "applyTheme", "theme", "initializePopup", "initPopup", "popupId", "showBtnId", "closeBtnId", "addChoiceBtnId", "submitBtnId", "choicesContainerId", "action", "popup", "showBtn", "closeBtn", "addChoiceBtn", "choicesContainer", "submitBtn", "event", "key", "btnHtmlTree", "protectStory"]
}
